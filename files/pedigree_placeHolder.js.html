<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>pedigree&#x2F;placeHolder.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/AbstractHoverbox.html">AbstractHoverbox</a></li>
            
                <li><a href="..&#x2F;classes/AbstractNode.html">AbstractNode</a></li>
            
                <li><a href="..&#x2F;classes/AbstractNodeVisuals.html">AbstractNodeVisuals</a></li>
            
                <li><a href="..&#x2F;classes/AbstractPerson.html">AbstractPerson</a></li>
            
                <li><a href="..&#x2F;classes/AbstractPersonVisuals.html">AbstractPersonVisuals</a></li>
            
                <li><a href="..&#x2F;classes/ActionStack.html">ActionStack</a></li>
            
                <li><a href="..&#x2F;classes/Graph.html">Graph</a></li>
            
                <li><a href="..&#x2F;classes/GroupHoverbox.html">GroupHoverbox</a></li>
            
                <li><a href="..&#x2F;classes/Legend.html">Legend</a></li>
            
                <li><a href="..&#x2F;classes/NodeMenu.html">NodeMenu</a></li>
            
                <li><a href="..&#x2F;classes/NodetypeSelectionBubble.html">NodetypeSelectionBubble</a></li>
            
                <li><a href="..&#x2F;classes/Partnership.html">Partnership</a></li>
            
                <li><a href="..&#x2F;classes/PartnershipHoverbox.html">PartnershipHoverbox</a></li>
            
                <li><a href="..&#x2F;classes/PartnershipVisuals.html">PartnershipVisuals</a></li>
            
                <li><a href="..&#x2F;classes/PedigreeEditor.html">PedigreeEditor</a></li>
            
                <li><a href="..&#x2F;classes/Person.html">Person</a></li>
            
                <li><a href="..&#x2F;classes/PersonGroup.html">PersonGroup</a></li>
            
                <li><a href="..&#x2F;classes/PersonGroupVisuals.html">PersonGroupVisuals</a></li>
            
                <li><a href="..&#x2F;classes/PersonHoverbox.html">PersonHoverbox</a></li>
            
                <li><a href="..&#x2F;classes/PersonVisuals.html">PersonVisuals</a></li>
            
                <li><a href="..&#x2F;classes/PlaceHolder.html">PlaceHolder</a></li>
            
                <li><a href="..&#x2F;classes/PlaceHolderVisuals.html">PlaceHolderVisuals</a></li>
            
                <li><a href="..&#x2F;classes/Pregnancy.html">Pregnancy</a></li>
            
                <li><a href="..&#x2F;classes/PregnancyVisuals.html">PregnancyVisuals</a></li>
            
                <li><a href="..&#x2F;classes/SaveLoadEngine.html">SaveLoadEngine</a></li>
            
                <li><a href="..&#x2F;classes/SaveLoadIndicator.html">SaveLoadIndicator</a></li>
            
                <li><a href="..&#x2F;classes/TemplateSelector.html">TemplateSelector</a></li>
            
                <li><a href="..&#x2F;classes/Workspace.html">Workspace</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: pedigree&#x2F;placeHolder.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * PlaceHolder objects act as reminders for the user that information about relatives is missing. A PlaceHolder
 * shares common traits with a Person, such as id, gender and position but it will not be displayed in the
 * final exported version of the graph. Placeholders use a dotted outline to distinguish themselves from
 * Person nodes.
 *
 * @class PlaceHolder
 * @extends AbstractPerson
 * @constructor
 * @param {Number} x X coordinate on the Raphael canvas at which the node drawing will be centered
 * @param {Number} y Y coordinate on the Raphael canvas at which the node drawing will be centered
 * @param {String} gender &#x27;M&#x27;, &#x27;F&#x27; or &#x27;U&#x27;
 * @param {Number} id Unique ID number
 *&#x2F;

var PlaceHolder = Class.create(AbstractPerson, {

    initialize: function($super, x, y, gender, id) {
        this._type = &quot;PlaceHolder&quot;;
        $super(x, y, gender, id);
    },

    &#x2F;**
     * Initializes the object responsible for creating graphics for this PlaceHolder
     *
     * @method _generateGraphics
     * @param {Number} x X coordinate on the Raphael canvas at which the node drawing will be centered
     * @param {Number} y Y coordinate on the Raphael canvas at which the node drawing will be centered
     * @return {PlaceHolderVisuals}
     * @private
     *&#x2F;
    _generateGraphics: function(x, y) {
        return new PlaceHolderVisuals(this, x, y);
    },

    &#x2F;**
     * Replaces this PlaceHolder with new node of given type and gender.
     * Creates an action stack entry
     *
     * @method createNodeAction
     * @param {String} type &quot;Person&quot; or &quot;PersonGroup&quot;
     * @param {String} gender &quot;M&quot;, &quot;F&quot;, or &quot;U&quot;
     *&#x2F;
    createNodeAction: function(type, gender) {
        var replacement = editor.getGraph()[&quot;add&quot; + type](this.getX(), this.getY(), gender);
        if(replacement) {
            var nodeInfo = replacement.getInfo();
            this.mergeAction(replacement, this.getX(), this.getY());
            var oldUndo = editor.getActionStack().peek().undo;
            var oldRedo = editor.getActionStack().peek().redo;
            editor.getActionStack().getStack()[editor.getActionStack().size() - 1] =
            {
                undo: function() {
                    oldUndo();
                    var node = editor.getGraph().getNodeMap()[nodeInfo.id];
                    node &amp;&amp; node.remove(false);
                },

                redo: function() {
                    var node = editor.getGraph()[&quot;add&quot; + type](nodeInfo.x, nodeInfo.y, gender, nodeInfo.id);
                    oldRedo();
                }
            }

        }
    },

    &#x2F;**
     * Replaces this PlaceHolder with new node of given type and gender.
     * Creates an action stack entry
     *
     * @method createNodeAction
     * @param {String} type &quot;Person&quot; or &quot;PersonGroup&quot;
     * @param {String} gender &quot;M&quot;, &quot;F&quot;, or &quot;U&quot;
     *&#x2F;
    convertTo: function(type, gender) {
        var replacement = editor.getGraph()[&quot;add&quot; + type](this.getX(), this.getY(), gender);
        this.merge(replacement);
        return replacement;
        &#x2F;&#x2F;document.fire(&#x27;pedigree:node:upgraded&#x27;, {&#x27;node&#x27; : replacement, &#x27;relatedNodes&#x27; : [], &#x27;sourceNode&#x27; : this});
    },

    &#x2F;**
     * Attributes all of the connections of this placeholder to person and removes the placeholder.
     *
     * @method merge
     * @param {Person} person
     * @return {Person} The person with which the node was merged or null if merge was unsuccessful
     *&#x2F;
    merge: function(person) {
        if(this.canMergeWith(person)) {
            var parents = this.getParentPartnership();
            if(parents) {
                (parents.getChildren().indexOf(person) == -1) &amp;&amp; this.getParentPregnancy().addChild(person);
                this.getParentPregnancy().removeChild(this);
            }
            var partnerships = this.getPartnerships();
            var me = this;

            partnerships.each(function(partnership){
                var partner = partnership.getPartnerOf(me);
                var newPartnership;
                if(person.getPartners().indexOf(partner) == -1) {
                    newPartnership = person.addPartner(partnership.getPartnerOf(me), true);
                }
                else {
                    newPartnership = person.getPartnership(partner)
                }
                partnership.getPregnancies().each(function(pregnancy) {
                    var newPreg = newPartnership.createPregnancy();
                    pregnancy.getChildren().each(function(child) {
                        pregnancy.removeChild(child);
                        newPreg.addChild(child);
                    });
                });
                partnership.remove(false);
            });
            me &amp;&amp; me.remove(false);
            return person;
        }
        return null;
    },

    &#x2F;**
     * Returns true if this placeholder is not a partner, descendant or ancestor of person, and if person has
     * no parent conflict with the placeholder
     *
     * @method canMergeWith
     * @param {Person} person
     * @return {Boolean}
     *&#x2F;
    canMergeWith: function(person) {
        return (person.getGender() == this.getGender() || this.getGender() == &#x27;U&#x27; || person.getGender() == &quot;U&quot; ) &amp;&amp;
            !person.isPartnerOf(this) &amp;&amp;
            !this.hasConflictingParents(person) &amp;&amp;
            !person.isDescendantOf(this) &amp;&amp;
            !person.isAncestorOf(this);
    },

    &#x2F;**
     * Returns true if person has a different set of parents than this placeholder
     *
     * @method hasConflictingParents
     * @return {Boolean}
     *&#x2F;
    hasConflictingParents: function(person) {
        return (this.getParentPartnership() != null
            &amp;&amp; person.getParentPartnership() != null
            &amp;&amp; this.getParentPartnership() != person.getParentPartnership());
    },

    &#x2F;**
     * Attributes all of the connections of this placeholder to person and removes the placeholder.
     * Creates entry in the action stack.
     *
     * @method merge
     * @param {Person} person
     * @param {Number} originalX The original x coordinate of the PlaceHolder
     * @param {Number} originalY The original y coordinate of the PlaceHolder
     *&#x2F;
    mergeAction: function(person, originalX, originalY) {
        var me = this,
            source = this.getInfo(),
            target = person.getInfo(),
            parentPreg = this.getParentPregnancy() ? this.getParentPregnancy().getInfo() : null;
        var phPartnerships = [];
        var phPregnancies = [];
        me.getPartnerships().each(function(partnership) {
            phPartnerships.push({
                id: partnership.getID(),
                x: partnership.getX(),
                y: partnership.getY(),
                partnerID: partnership.getPartnerOf(me).getID()
            });
            partnership.getPregnancies().each(function(pregnancy) {
                var info = {
                    id: pregnancy.getID(),
                    x: pregnancy.getX(),
                    y: pregnancy.getY(),
                    partnershipID: pregnancy.getPartnership().getID(),
                    childrenIDs: []
                };
                pregnancy.getChildren().each(function(child) {
                    info.childrenIDs.push(child.getID());
                });
                phPregnancies.push(info);
            });
        });

        var oldPartnerships = [];
        var oldPregnancies = [];

        person.getPartnerships().each(function(partnership) {
            oldPartnerships.push(partnership.getID());
            partnership.getPregnancies().each(function(pregnancy) {
                oldPregnancies.push(pregnancy.getID())
            });
        });

        if(this.merge(person)) {
            var newParentPreg = person.getParentPregnancy();
            if(newParentPreg) {
                newParentPreg = newParentPreg.getInfo();
            }
            var newPartnerships = [];
            var newPregnancies = [];
            person.getPartnerships().each(function(partnership) {
                if(oldPartnerships.indexOf(partnership.getID()) == -1) {
                    newPartnerships.push({
                        id: partnership.getID(),
                        x: partnership.getX(),
                        y: partnership.getY(),
                        partnerID: partnership.getPartnerOf(person).getID()
                    });
                }
                partnership.getPregnancies().each(function(pregnancy) {
                    if(oldPregnancies.indexOf(pregnancy.getID()) == -1) {
                        var info = {
                            id: pregnancy.getID(),
                            x: pregnancy.getX(),
                            y: pregnancy.getY(),
                            partnershipID: pregnancy.getPartnership().getID(),
                            childrenIDs: []
                        };
                        pregnancy.getChildren().each(function(child) {
                            info.childrenIDs.push(child.getID());
                        });
                        newPregnancies.push(info);
                    }
                });
            });

            var undoFunct = function() {
                var ph = editor.getGraph().addPlaceHolder(source.x, source.y, source.gender, source.id);
                if(parentPreg &amp;&amp; newParentPreg) {
                    var pPregnancy = editor.getGraph().getNodeMap()[newParentPreg.id];
                    var pPartnership;
                    if(pPregnancy) {
                        pPartnership = pPregnancy.getPartnership();
                        pPregnancy.remove(false);
                    }
                    if(pPartnership) {
                        var ppreg = editor.getGraph().addPregnancy(parentPreg.x, parentPreg.y, pPartnership,
                            parentPreg.id);
                        ppreg.addChild(ph);
                    }
                }
                newPregnancies.each(function(pregnancy) {
                    var preg = editor.getGraph().getNodeMap()[pregnancy.id];
                    preg &amp;&amp; preg.remove(false);
                });
                newPartnerships.each(function(partnership) {
                    var part = editor.getGraph().getNodeMap()[partnership.id];
                    part &amp;&amp; part.remove(false);
                });

                phPartnerships.each(function(partnership) {
                    var partner = editor.getGraph().getNodeMap()[partnership.partnerID];
                    if(partner) {
                        editor.getGraph().addPartnership(partnership.x, partnership.y, ph, partner,partnership.id);
                    }
                });

                phPregnancies.each(function(pregnancy) {
                    var partnership = editor.getGraph().getNodeMap()[pregnancy.partnershipID];
                    if(partnership) {
                        var preg  = editor.getGraph().addPregnancy(pregnancy.x, pregnancy.y, partnership, pregnancy.id);
                        pregnancy.childrenIDs.each(function(child) {
                            var c = editor.getGraph().getNodeMap()[child];
                            c &amp;&amp; preg.addChild(c);
                        });
                    }
                });

                ph.setPos(originalX,originalY, true);
            };

            var redoFunct = function() {
                var targetPerson = editor.getGraph().getNodeMap()[target.id];
                if(parentPreg &amp;&amp; newParentPreg) {
                    var pPregnancy = editor.getGraph().getNodeMap()[parentPreg.id];
                    var pPartnership;
                    if(pPregnancy) {
                        pPartnership = pPregnancy.getPartnership();
                        pPregnancy.remove(false);
                    }
                    if(pPartnership) {
                        var ppreg = editor.getGraph().addPregnancy(newParentPreg.x, newParentPreg.y, pPartnership,
                                                                                                    newParentPreg.id);
                        ppreg.addChild(targetPerson);
                    }
                }
                if(targetPerson) {
                    phPregnancies.each(function(pregnancy) {
                        var preg = editor.getGraph().getNodeMap()[pregnancy.id];
                        preg &amp;&amp; preg.remove(false);
                    });
                    phPartnerships.each(function(partnership) {
                        var part = editor.getGraph().getNodeMap()[partnership.id];
                        part &amp;&amp; part.remove(false);
                    });
                    newPartnerships.each(function(partnership) {
                        var partner = editor.getGraph().getNodeMap()[partnership.partnerID];
                        if(partner) {
                            editor.getGraph().addPartnership(partnership.x, partnership.y, partner,
                                                                                targetPerson, partnership.id)
                        }
                    });

                    newPregnancies.each(function(pregnancy) {
                        var partnership = editor.getGraph().getNodeMap()[pregnancy.partnershipID];
                        if(partnership) {
                            var preg = editor.getGraph().addPregnancy(pregnancy.x, pregnancy.y, partnership, pregnancy.id)
                            pregnancy.childrenIDs.each(function(childID) {
                                var child = editor.getGraph().getNodeMap()[childID];
                                child &amp;&amp; preg.addChild(child);
                            })
                        }
                    })
                }
            };
            editor.getActionStack().push({undo: undoFunct, redo: redoFunct});
        }
    }
});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
